<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÙ„ÛŒØ¯ - Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</title>
    <style>
        body { font-family: Tahoma, sans-serif; background: #f0f2f5; padding: 10px; margin: 0; direction: rtl; }
        .box { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; }
        input, textarea { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-family: Tahoma; font-size: 14px; }
        input { flex: 1; }
        button { padding: 10px 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-family: Tahoma; }
        .btn-p { background: #2ecc71; color: white; }
        .btn-s { background: #3498db; color: white; }
        .table-wrap { overflow-x: auto; margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; }
        table { border-collapse: collapse; width: 100%; background: white; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: center; min-width: 120px; }
        th { background: #34495e; color: white; font-size: 13px; }
        .cell { cursor: pointer; white-space: pre-wrap; font-size: 12px; min-height: 50px; background: #fff; }
        .has-note { background: #e3f2fd !important; border-right: 4px solid #2196f3 !important; }
        .done-row td { background: #d4edda !important; color: #155724; }
        .action-btn { font-size: 10px; color: #e74c3c; display: block; margin-top: 8px; text-decoration: underline; cursor: pointer; }
        
        /* Modal */
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; }
        #noteModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                    background: white; padding: 20px; border-radius: 15px; z-index: 101; width: 85%; max-width: 400px; }
    </style>
</head>
<body>

<div class="box">
    <h3 style="text-align:center; margin-top:0;">ğŸ“‹ Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡</h3>
    
    <div class="input-group">
        <input type="text" id="p_name" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯...">
        <button class="btn-p" onclick="fnAddP()">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
    </div>
    <div class="input-group">
        <input type="text" id="s_name" placeholder="Ù…Ø±Ø­Ù„Ù‡ Ø¬Ø¯ÛŒØ¯...">
        <button class="btn-s" onclick="fnAddS()">+ Ù…Ø±Ø­Ù„Ù‡</button>
    </div>

    <div class="table-wrap">
        <table>
            <thead><tr id="h_row"></tr></thead>
            <tbody id="t_body"></tbody>
        </table>
    </div>
</div>

<div id="modalOverlay" onclick="fnClose()"></div>
<div id="noteModal">
    <h4 style="margin-top:0">ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ùˆ ØªØ§Ø±ÛŒØ®</h4>
    <textarea id="m_txt" style="width:100%; height:120px; box-sizing: border-box;" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øª... (Ø§ÛŒÙ†ØªØ± Ø¨Ø±Ø§ÛŒ Ø®Ø· Ø¨Ø¹Ø¯)"></textarea>
    <br><br>
    <input type="text" id="m_date" style="width:100%; box-sizing: border-box;" placeholder="ØªØ§Ø±ÛŒØ®">
    <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="btn-p" style="flex:1" onclick="fnSave()">Ø°Ø®ÛŒØ±Ù‡</button>
        <button style="background:#95a5a6; color:white; flex:1" onclick="fnClose()">Ù„ØºÙˆ</button>
    </div>
</div>

<script>
    // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ
    var STORAGE_P = "APP_PROJS_FINAL";
    var STORAGE_S = "APP_STEPS_FINAL";

    var mySteps = JSON.parse(localStorage.getItem(STORAGE_S)) || [];
    var myProjs = JSON.parse(localStorage.getItem(STORAGE_P)) || [];
    var activeP = null, activeS = null;

    function fnUpdate() {
        localStorage.setItem(STORAGE_S, JSON.stringify(mySteps));
        localStorage.setItem(STORAGE_P, JSON.stringify(myProjs));
        fnDraw();
    }

    function fnAddP() {
        var val = document.getElementById('p_name').value;
        if(val) { 
            myProjs.push({ name: val, data: {}, isDone: false }); 
            document.getElementById('p_name').value = ''; 
            fnUpdate(); 
        }
    }

    function fnAddS() {
        var val = document.getElementById('s_name').value;
        if(val) { 
            mySteps.push(val); 
            document.getElementById('s_name').value = ''; 
            fnUpdate(); 
        }
    }

    function fnOpen(pi, si) {
        activeP = pi; activeS = si;
        var item = myProjs[pi].data[si] || { t: "", d: new Date().toLocaleDateString('fa-IR') };
        document.getElementById('m_txt').value = item.t;
        document.getElementById('m_date').value = item.d;
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('noteModal').style.display = 'block';
    }

    function fnSave() {
        var txt = document.getElementById('m_txt').value;
        var dat = document.getElementById('m_date').value;
        myProjs[activeP].data[activeS] = { t: txt, d: dat };
        fnClose();
        fnUpdate();
    }

    function fnClose() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('noteModal').style.display = 'none';
    }

    function fnToggle(i) { myProjs[i].isDone = !myProjs[i].isDone; fnUpdate(); }
    function fnDelP(i) { if(confirm('Ø­Ø°Ù Ú©Ø§Ù…Ù„ Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ØŸ')) { myProjs.splice(i,1); fnUpdate(); } }
    function fnDelS(i) { if(confirm('Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø§Ø² Ú©Ù„ Ù„ÛŒØ³ØªØŸ')) { mySteps.splice(i,1); fnUpdate(); } }

    function fnDraw() {
        var hr = document.getElementById('h_row');
        hr.innerHTML = '<th>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</th>';
        mySteps.forEach((s, i) => {
            hr.innerHTML += `<th>${s}<span class="action-btn" onclick="fnDelS(${i})">Ø­Ø°Ù Ù…Ø±Ø­Ù„Ù‡</span></th>`;
        });

        var tb = document.getElementById('t_body');
        tb.innerHTML = '';
        myProjs.forEach((p, pi) => {
            var rClass = p.isDone ? 'done-row' : '';
            var row = `<tr class="${rClass}">
                <td>
                    <b>${p.name}</b>
                    <span class="action-btn" style="color:#27ae60" onclick="fnToggle(${pi})">${p.isDone ? 'â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª' : 'âœ… Ø§ØªÙ…Ø§Ù…'}</span>
                    <span class="action-btn" onclick="fnDelP(${pi})">ğŸ—‘ Ø­Ø°Ù</span>
                </td>`;
            mySteps.forEach((s, si) => {
                var cellData = p.data[si] || {t:"", d:""};
                var has = cellData.t ? 'has-note' : '';
                var content = cellData.t ? `<b>${cellData.t}</b><br><small>${cellData.d}</small>` : '---';
                row += `<td class="cell ${has}" onclick="fnOpen(${pi}, ${si})">${content}</td>`;
            });
            row += '</tr>';
            tb.innerHTML += row;
        });
    }

    fnDraw();
</script>
</body>
</html>
