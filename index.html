<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
    <style>
        body { font-family: Tahoma; padding: 10px; background: #f0f2f5; direction: rtl; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 15px; display: flex; gap: 5px; }
        input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 12px; }
        th { background: #34495e; color: white; }
        .done-p { background: #d4edda !important; } /* Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ */
        .done-s { border: 3px solid #28a745 !important; background: #f0fff0; } /* Ú©Ø§Ø¯Ø± Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ */
        .cell { cursor: pointer; white-space: pre-wrap; min-height: 40px; }
    </style>
</head>
<body>

<div class="card">
    <div class="input-group">
        <input type="text" id="pI" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡">
        <button style="background:#27ae60; color:white" onclick="addP()">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
    </div>
    <div class="input-group">
        <input type="text" id="sI" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡">
        <button style="background:#2980b9; color:white" onclick="addS()">+ Ù…Ø±Ø­Ù„Ù‡</button>
    </div>

    <div style="overflow-x: auto;">
        <table>
            <thead id="h"></thead>
            <tbody id="b"></tbody>
        </table>
    </div>
    
    <button onclick="exportData()" style="width:100%; margin-top:20px; background:#8e44ad; color:white; padding:12px; border-radius:8px;">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
</div>

<script>
    var S = JSON.parse(localStorage.getItem('S_V15')) || [];
    var P = JSON.parse(localStorage.getItem('P_V15')) || [];

    function render() {
        localStorage.setItem('S_V15', JSON.stringify(S));
        localStorage.setItem('P_V15', JSON.stringify(P));

        document.getElementById('h').innerHTML = '<tr><th>Ù¾Ø±ÙˆÚ˜Ù‡</th>' + S.map((s,i) => `<th>${s}<br><small onclick="delS(${i})" style="color:red">Ø­Ø°Ù</small></th>`).join('') + '</tr>';

        var html = '';
        P.forEach((p, pi) => {
            var pCls = p.f ? 'done-p' : '';
            html += `<tr class="${pCls}">
                <td onclick="toggleP(${pi})"><b>${p.n}</b><br><small style="color:blue">${p.f?'(ØªÙ…Ø§Ù… Ø´Ø¯Ù‡)':'(Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†)'}</small></td>`;
            S.forEach((s, si) => {
                var d = p.d[si] || {t:'', f:false};
                var sCls = d.f ? 'done-s' : '';
                html += `<td class="cell ${sCls}" onclick="manageCell(${pi}, ${si})">${d.f ? 'âœ… ' : ''}${d.t}</td>`;
            });
            html += '</tr>';
        });
        document.getElementById('b').innerHTML = html;
    }

    function addP() { var v=document.getElementById('pI').value; if(v){ P.push({n:v, d:{}, f:false}); document.getElementById('pI').value=''; render(); } }
    function addS() { var v=document.getElementById('sI').value; if(v){ S.push(v); document.getElementById('sI').value=''; render(); } }
    function delS(i) { if(confirm('Ø­Ø°Ù Ù…Ø±Ø­Ù„Ù‡ØŸ')) { S.splice(i,1); render(); } }
    
    // Ø§ØªÙ…Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡
    function toggleP(pi) { if(confirm('ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ Ù¾Ø±ÙˆÚ˜Ù‡ØŸ')) { P[pi].f = !P[pi].f; render(); } }

    // Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ø­Ù„Ù‡ (Ø§Ø¯ÛŒØª Ùˆ Ø§ØªÙ…Ø§Ù…)
    function manageCell(pi, si) {
        if(!P[pi].d[si]) P[pi].d[si] = {t:'',
