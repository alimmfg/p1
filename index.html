<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡</title>
    <style>
        body { font-family: sans-serif; background: #eee; padding: 10px; direction: rtl; }
        .box { background: white; padding: 10px; border-radius: 10px; }
        .input-area { margin-bottom: 15px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; width: 150px; }
        button { padding: 8px 12px; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #999; padding: 8px; text-align: center; font-size: 13px; }
        th { background: #333; color: white; }
        .cell { cursor: pointer; min-height: 40px; }
        .green { background: #9f9 !important; } /* Ù…Ø±Ø­Ù„Ù‡ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ */
        .blue { background: #cef !important; } /* ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¯Ø§Ø± */
        .del { color: red; font-size: 10px; display: block; margin-top: 5px; cursor: pointer; }
        
        #pop { display: none; position: fixed; top: 15%; left: 5%; right: 5%; background: white; 
               padding: 20px; border: 3px solid #333; z-index: 1000; border-radius: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h3>ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡ (Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡)</h3>
    <div class="input-area">
        <input type="text" id="ip" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡">
        <button style="background:green; color:white;" onclick="addP()">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
        <br>
        <input type="text" id="is" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡">
        <button style="background:blue; color:white;" onclick="addS()">+ Ù…Ø±Ø­Ù„Ù‡</button>
    </div>

    <div style="overflow-x:auto;">
        <table id="tbl">
            <thead><tr id="hr"></tr></thead>
            <tbody id="tb"></tbody>
        </table>
    </div>
</div>

<div id="pop">
    <b>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ùˆ ÙˆØ¶Ø¹ÛŒØª:</b><br>
    <textarea id="txt" style="width:100%; height:80px; margin-top:10px;"></textarea><br>
    <input type="text" id="dt" placeholder="ØªØ§Ø±ÛŒØ®" style="width:90%"><br><br>
    <button id="btnFin" style="background:green; color:white; width:100%">âœ… Ø§ØªÙ…Ø§Ù… Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡</button><br><br>
    <button onclick="save()" style="background:blue; color:white;">Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</button>
    <button onclick="document.getElementById('pop').style.display='none'">Ø¨Ø³ØªÙ†</button>
</div>

<script>
    var S = JSON.parse(localStorage.getItem('ST_V8')) || [];
    var P = JSON.parse(localStorage.getItem('PR_V8')) || [];
    var currP, currS;

    function draw() {
        localStorage.setItem('ST_V8', JSON.stringify(S));
        localStorage.setItem('PR_V8', JSON.stringify(P));

        var hr = document.getElementById('hr');
        hr.innerHTML = '<th>Ù¾Ø±ÙˆÚ˜Ù‡</th>';
        S.forEach((s, i) => hr.innerHTML += '<th>'+s+' <span class="del" onclick="delS('+i+')">Ø­Ø°Ù</span></th>');

        var tb = document.getElementById('tb');
        tb.innerHTML = '';
        P.forEach((p, pi) => {
            var r = '<tr><td><b>'+p.n+'</b> <span class="del" onclick="delP('+pi+')">Ø­Ø°Ù</span></td>';
            S.forEach((s, si) => {
                var d = p.d[si] || {t:'', dt:'', f:false};
                var cls = d.f ? 'cell green' : (d.t ? 'cell blue' : 'cell');
                var text = d.f ? 'âœ… ØªÙ…Ø§Ù… Ø´Ø¯Ù‡<br>'+d.t : (d.t || '---');
                r += '<td class="'+cls+'" onclick="openP('+pi+','+si+')">'+text+'<br><small>'+d.dt+'</small></td>';
            });
            r += '</tr>';
            tb.innerHTML += r;
        });
    }

    function addP() { var v = document.getElementById('ip').value; if(v){ P.push({n:v, d:{}}); document.getElementById('ip').value=''; draw(); } }
    function addS() { var v = document.getElementById('is').value; if(v){ S.push(v); document.getElementById('is').value=''; draw(); } }
    
    function openP(pi, si) {
        currP = pi; currS = si;
        var d = P[pi].d[si] || {t:'', dt: new Date().toLocaleDateString('fa-IR'), f:false};
        document.getElementById('txt').value = d.t;
        document.getElementById('dt').value = d.dt;
        document.getElementById('pop').style.display = 'block';
        
        var b = document.getElementById('btnFin');
        b.innerText = d.f ? "â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙˆÙ„ÛŒØ¯" : "âœ… Ø§ØªÙ…Ø§Ù… Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡";
        b.onclick = function() {
            if(!P[currP].d[currS]) P[currP].d[currS] = {t:'', dt:'', f:false};
            P[currP].d[currS].f = !P[currP].d[currS].f;
            document.getElementById('pop').style.display='none'; draw();
        };
    }

    function save() {
        if(!P[currP].d[currS]) P[currP].d[currS] = {f:false};
        P[currP].d[currS].t = document.getElementById('txt').value;
        P[currP].d[currS].dt = document.getElementById('dt').value;
        document.getElementById('pop').style.display='none'; draw();
    }

    function delP(i) { if(confirm('Ø­Ø°ÙØŸ')) { P.splice(i,1); draw(); } }
    function delS(i) { if(confirm('Ø­Ø°ÙØŸ')) { S.splice(i,1); P.forEach(p=>delete p.d[i]); draw(); } }

    draw();
</script>
</body>
</html>
