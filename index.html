<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡ v6</title>
    <style>
        body { font-family: Tahoma, sans-serif; background-color: #f0f0f0; padding: 10px; margin: 0; text-align: right; }
        .container { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .controls { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        input, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: Tahoma; }
        input { flex: 1; min-width: 100px; }
        button { padding: 10px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .btn-green { background: #28a745; color: white; }
        .btn-blue { background: #007bff; color: white; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 13px; }
        th { background: #444; color: white; }
        .cell { cursor: pointer; white-space: pre-wrap; background: #fff; min-height: 40px; }
        .done { background-color: #d4edda !important; } /* Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡ */
        .has-text { background-color: #e3f2fd; border-right: 3px solid #2196f3; }
        .del { color: red; font-size: 10px; cursor: pointer; display: block; margin-top: 5px; }
        
        /* Ù¾Ù†Ø¬Ø±Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ */
        #modal { display: none; position: fixed; top: 20%; left: 5%; right: 5%; background: white; 
                 padding: 20px; border: 2px solid #333; z-index: 100; border-radius: 10px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 50; }
    </style>
</head>
<body>

<div class="container">
    <h3 style="margin-top:0">ğŸ“‹ Ù„ÛŒØ³Øª ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h3>
    
    <div class="controls">
        <input type="text" id="pInp" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡">
        <button class="btn-green" onclick="addProject()">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
    </div>
    <div class="controls">
        <input type="text" id="sInp" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡">
        <button class="btn-blue" onclick="addStep()">+ Ù…Ø±Ø­Ù„Ù‡</button>
    </div>

    <div style="overflow-x: auto;">
        <table id="table">
            <thead><tr id="hRow"></tr></thead>
            <tbody id="tBody"></tbody>
        </table>
    </div>
</div>

<div id="overlay"></div>
<div id="modal">
    <h4>ÙˆÛŒØ±Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h4>
    <textarea id="mText" style="width:95%; height:80px;" placeholder="Ù…ØªÙ† ÛŒØ§Ø¯Ø¯Ø§Ø´Øª (Ø§ÛŒÙ†ØªØ± Ù…Ø¬Ø§Ø² Ø§Ø³Øª)"></textarea>
    <br><br>
    <input type="text" id="mDate" placeholder="ØªØ§Ø±ÛŒØ® (Ù…Ø«Ù„Ø§ 10/05)" style="width:95%">
    <br><br>
    <button class="btn-green" onclick="saveNote()">Ø°Ø®ÛŒØ±Ù‡</button>
    <button style="background:#ccc" onclick="closeModal()">Ù„ØºÙˆ</button>
</div>

<script>
    // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    var steps = JSON.parse(localStorage.getItem('S1')) || [];
    var projs = JSON.parse(localStorage.getItem('P1')) || [];
    var curP = null, curS = null;

    function refresh() {
        localStorage.setItem('S1', JSON.stringify(steps));
        localStorage.setItem('P1', JSON.stringify(projs));
        
        // Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„ (ØªÛŒØªØ±Ù‡Ø§)
        var hr = document.getElementById('hRow');
        hr.innerHTML = '<th>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</th>';
        steps.forEach(function(s, i) {
            hr.innerHTML += '<th>' + s + '<span class="del" onclick="delStep('+i+')">Ø­Ø°Ù</span></th>';
        });

        // Ø¨Ø¯Ù†Ù‡ Ø¬Ø¯ÙˆÙ„
        var tb = document.getElementById('tBody');
        tb.innerHTML = '';
        projs.forEach(function(p, pi) {
            var row = '<tr class="' + (p.f ? 'done' : '') + '">';
            row += '<td><b>' + p.n + '</b><span class="del" onclick="toggleF('+pi+')">' + (p.f?'â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª':'âœ… Ø§ØªÙ…Ø§Ù…') + '</span><span class="del" onclick="delProj('+pi+')">ğŸ—‘ Ø­Ø°Ù</span></td>';
            
            steps.forEach(function(s, si) {
                var d = p.d[si] || {t:'', dt:''};
                var display = d.t ? '<b>'+d.t+'</b><br>'+d.dt : '---';
                var cls = d.t ? 'cell has-text' : 'cell';
                row += '<td class="'+cls+'" onclick="openNote('+pi+','+si+')">' + display + '</td>';
            });
            row += '</tr>';
            tb.innerHTML += row;
        });
    }

    function addProject() {
        var v = document.getElementById('pInp').value;
        if(v) { projs.push({n:v, d:{}, f:false}); document.getElementById('pInp').value=''; refresh(); }
    }

    function addStep() {
        var v = document.getElementById('sInp').value;
        if(v) { steps.push(v); document.getElementById('sInp').value=''; refresh(); }
    }

    function openNote(pi, si) {
        curP = pi; curS = si;
        var d = projs[pi].d[si] || {t:'', dt:''};
        document.getElementById('mText').value = d.t;
        document.getElementById('mDate').value = d.dt || new Date().toLocaleDateString('fa-IR');
        document.getElementById('modal').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function saveNote() {
        projs[curP].d[curS] = { t: document.getElementById('mText').value, dt: document.getElementById('mDate').value };
        closeModal(); refresh();
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function delProj(i) { if(confirm('Ø­Ø°Ù Ù¾Ø±ÙˆÚ˜Ù‡ØŸ')) { projs.splice(i,1); refresh(); } }
    function delStep(i) { if(confirm('Ø­Ø°Ù Ù…Ø±Ø­Ù„Ù‡ØŸ')) { steps.splice(i,1); refresh(); } }
    function toggleF(i) { projs[i].f = !projs[i].f; refresh(); }

    // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    refresh();
</script>
</body>
</html>
