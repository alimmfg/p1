<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Tahoma; direction: rtl; padding: 20px; background: #f0f0f0; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input { padding: 10px; width: 200px; margin-bottom: 10px; border: 1px solid #ccc; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 10px; text-align: center; }
        th { background: #333; color: white; }
        .log { text-align: right; font-size: 12px; white-space: pre-wrap; }
        .date { color: orange; font-weight: bold; display: block; font-size: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ú¯Ø§Ù‡ (Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ù‚Ø·Ø¹ÛŒ)</h2>
    
    <input type="text" id="p_name" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡">
    <button onclick="newP()">+ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡</button>
    <br>
    <input type="text" id="s_name" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡">
    <button onclick="newS()" style="background: #007bff">+ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø±Ø­Ù„Ù‡</button>

    <table id="tbl">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
    </table>
    
    <br>
    <button onclick="saveFile()" style="background: #6f42c1;">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
</div>

<script>
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÛŒÚ© Ø§Ø³Ù… Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ Ú©Ù‡ Ø¨Ø§ Ù‚Ø¨Ù„ÛŒâ€ŒÙ‡Ø§ Ù‚Ø§Ø·ÛŒ Ù†Ø´ÙˆØ¯
    var LIST_P = JSON.parse(localStorage.getItem('WORKSHOP_VER_10')) || [];
    var LIST_S = JSON.parse(localStorage.getItem('WORKSHOP_STEPS_10')) || [];

    function show() {
        localStorage.setItem('WORKSHOP_VER_10', JSON.stringify(LIST_P));
        localStorage.setItem('WORKSHOP_STEPS_10', JSON.stringify(LIST_S));

        // Ù‡Ø¯ Ø¬Ø¯ÙˆÙ„
        var h = document.getElementById('thead');
        var txtH = '<tr><th>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</th>';
        for(var i=0; i<LIST_S.length; i++) {
            txtH += '<th>' + LIST_S[i] + '</th>';
        }
        h.innerHTML = txtH + '</tr>';

        // Ø¨Ø¯Ù†Ù‡ Ø¬Ø¯ÙˆÙ„
        var b = document.getElementById('tbody');
        var txtB = '';
        for(var j=0; j<LIST_P.length; j++) {
            txtB += '<tr><td><b>' + LIST_P[j].name + '</b></td>';
            for(var k=0; k<LIST_S.length; k++) {
                var data = LIST_P[j].cells[k] || '';
                txtB += '<td onclick="addLog('+j+','+k+')"><div class="log">' + data + '</div></td>';
            }
            txtB += '</tr>';
        }
        b.innerHTML = txtB;
    }

    function newP() {
        var val = document.getElementById('p_name').value;
        if(val) {
            LIST_P.push({name: val, cells: {}});
            document.getElementById('p_name').value = '';
            show();
        }
    }

    function newS() {
        var val = document.getElementById('s_name').value;
        if(val) {
            LIST_S.push(val);
            document.getElementById('s_name').value = '';
            show();
        }
    }

    function addLog(pIdx, sIdx) {
        var msg = prompt("Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯:");
        if(msg) {
            var date = new Date().toLocaleDateString('fa-IR');
            var time = new Date().getHours() + ":" + new Date().getMinutes();
            var entry = '<span class="date">' + date + ' ' + time + '</span>' + msg + '<br>';
            
            if(!LIST_P[pIdx].cells[sIdx]) LIST_P[pIdx].cells[sIdx] = '';
            LIST_P[pIdx].cells[sIdx] = entry + LIST_P[pIdx].cells[sIdx];
            show();
        }
    }

    function saveFile() {
        var a = document.createElement('a');
        var data = JSON.stringify({LIST_P, LIST_S});
        a.href = URL.createObjectURL(new Blob([data], {type: 'application/json'}));
        a.download = "backup.json";
        a.click();
    }

    show();
</script>

</body>
</html>
