<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Tahoma; padding: 10px; direction: rtl; background: #eee; }
        .card { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px #ccc; }
        input { width: 60%; padding: 8px; margin: 5px 0; }
        button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 13px; }
        .p-done { background: #c8e6c9 !important; }
        .s-done { background: #e3f2fd; border: 2px solid blue !important; }
    </style>
</head>
<body>

<div class="card">
    <input type="text" id="pi" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡">
    <button onclick="addP()" style="background:green; color:#fff">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
    <br>
    <input type="text" id="si" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡">
    <button onclick="addS()" style="background:blue; color:#fff">+ Ù…Ø±Ø­Ù„Ù‡</button>

    <div style="overflow-x: auto;">
        <table id="tbl">
            <thead id="h"></thead>
            <tbody id="b"></tbody>
        </table>
    </div>
    <br>
    <button onclick="save()" style="width:100%; background:#6a1b9a; color:#fff">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
</div>

<script>
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³Ø§Ù…ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„
    var S = JSON.parse(localStorage.getItem('steps_fix')) || [];
    var P = JSON.parse(localStorage.getItem('projs_fix')) || [];

    function render() {
        localStorage.setItem('steps_fix', JSON.stringify(S));
        localStorage.setItem('projs_fix', JSON.stringify(P));
        
        var h = document.getElementById('h');
        var headHtml = '<tr><th>Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡</th>';
        for(var i=0; i<S.length; i++) {
            headHtml += '<th>' + S[i] + ' <span onclick="delS('+i+')" style="color:red; font-size:10px">[Ø­Ø°Ù]</span></th>';
        }
        h.innerHTML = headHtml + '</tr>';

        var b = document.getElementById('b');
        var bodyHtml = '';
        for(var j=0; j<P.length; j++) {
            var rowClass = P[j].f ? 'p-done' : '';
            bodyHtml += '<tr class="'+rowClass+'">';
            bodyHtml += '<td onclick="tgP('+j+')"><b>'+P[j].n+'</b><br><small>'+(P[j].f?'ØªÙ…Ø§Ù…':'Ø¬Ø§Ø±ÛŒ')+'</small></td>';
            for(var k=0; k<S.length; k++) {
                var d = P[j].d[k] || {t:'', f:false};
                var cellClass = d.f ? 's-done' : '';
                bodyHtml += '<td class="'+cellClass+'" onclick="ed('+j+','+k+')">'+ (d.f?'âœ… ':'') + d.t +'</td>';
            }
            bodyHtml += '</tr>';
        }
        b.innerHTML = bodyHtml;
    }

    function addP() {
        var v = document.getElementById('pi').value;
        if(v) { P.push({n:v, d:{}, f:false}); document.getElementById('pi').value=''; render(); }
    }

    function addS() {
        var v = document.getElementById('si').value;
        if(v) { S.push(v); document.getElementById('si').value=''; render(); }
    }

    function delS(i) { if(confirm('Ø­Ø°ÙØŸ')) { S.splice(i,1); render(); } }
    
    function tgP(i) { if(confirm('Ø§ØªÙ…Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ØŸ')) { P[i].f = !P[i].f; render(); } }

    function ed(pi, si) {
        if(!P[pi].d[si]) P[pi].d[si] = {t:'', f:false};
        var res = prompt("1. Ù…ØªÙ† Ú¯Ø²Ø§Ø±Ø´\n2. Ø¨Ø±Ø§ÛŒ ØªÛŒÚ© Ø³Ø¨Ø² Ø¨Ù†ÙˆÛŒØ³: ok\n3. Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¨Ù†ÙˆÛŒØ³: clear", P[pi].d[si].t);
        if(res !== null) {
            if(res.toLowerCase() == 'ok') {
                P[pi].d[si].f = !P[pi].d[si].f;
            } else if(res.toLowerCase() == 'clear') {
                P[pi].d[si] = {t:'', f:false};
            } else {
                var now = new Date();
                var time = now.getHours() + ":" + now.getMinutes();
                P[pi].d[si].t = time + " - " + res + "<br>" + P[pi].d[si].t;
            }
            render();
        }
    }

    function save() {
        var a = document.createElement("a");
        var file = new Blob([JSON.stringify({S,P})], {type: 'application/json'});
        a.href = URL.createObjectURL(file);
        a.download = "backup.json"; a.click();
    }

    render();
</script>
</body>
</html>
