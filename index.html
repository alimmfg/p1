<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Tahoma; padding: 10px; direction: rtl; background: #f9f9f9; }
        .box { background: #fff; padding: 15px; border-radius: 10px; border: 2px solid #ddd; }
        input { padding: 12px; width: 60%; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 5px; }
        button { padding: 12px; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; color: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #444; padding: 10px; text-align: center; }
        th { background: #34495e; color: white; }
        .p-name { cursor: pointer; color: #2c3e50; font-weight: bold; }
        .s-name { cursor: pointer; color: #fff; }
        .done { background: #d4edda !important; }
    </style>
</head>
<body>

<div class="box">
    <div style="margin-bottom: 20px;">
        <input type="text" id="p_in" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯">
        <button onclick="addProject()" style="background:#27ae60">+ Ù¾Ø±ÙˆÚ˜Ù‡</button>
        <br>
        <input type="text" id="s_in" placeholder="Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø¬Ø¯ÛŒØ¯">
        <button onclick="addStep()" style="background:#2980b9">+ Ù…Ø±Ø­Ù„Ù‡</button>
    </div>

    <div style="overflow-x: auto;">
        <table border="1">
            <thead id="h_t"></thead>
            <tbody id="b_t"></tbody>
        </table>
    </div>

    <button onclick="exportData()" style="width:100%; margin-top:20px; background:#8e44ad; padding:15px;">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
</div>

<script>
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù‚ÙÙ„ Ø´Ø¯Ù† Ù…Ø±ÙˆØ±Ú¯Ø±
    var prjs = [];
    var stps = [];

    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø¨Ù„ÛŒ
    try {
        prjs = JSON.parse(localStorage.getItem('P_DATA')) || [];
        stps = JSON.parse(localStorage.getItem('S_DATA')) || [];
    } catch(e) { console.log("Memory Reset"); }

    function refresh() {
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡
        localStorage.setItem('P_DATA', JSON.stringify(prjs));
        localStorage.setItem('S_DATA', JSON.stringify(stps));

        // Ø±Ù†Ø¯Ø± ØªÛŒØªØ±Ù‡Ø§ (Ù…Ø±Ø§Ø­Ù„)
        var h = document.getElementById('h_t');
        var headHtml = '<tr><th>Ù¾Ø±ÙˆÚ˜Ù‡ (Ø§Ø¯ÛŒØª)</th>';
        for(var i=0; i<stps.length; i++) {
            headHtml += '<th><span class="s-name" onclick="editS('+i+')">'+stps[i]+'</span><br><small onclick="delS('+i+')" style="color:red;font-size:10px">[Ø­Ø°Ù]</small></th>';
        }
        h.innerHTML = headHtml + '</tr>';

        // Ø±Ù†Ø¯Ø± Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ (Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§)
        var b = document.getElementById('b_t');
        b.innerHTML = '';
        for(var j=0; j<prjs.length; j++) {
            var p = prjs[j];
            var rowHtml = '<tr class="'+(p.f?'done':'')+'">';
            rowHtml += '<td><span class="p-name" onclick="editP('+j+')">'+p.n+'</span><br><button onclick="toggleP('+j+')" style="background:#666;font-size:9px;padding:3px">'+(p.f?'Ø¨Ø§Ø²Ú¯Ø´Øª':'Ø§ØªÙ…Ø§Ù…')+'</button></td>';
            
            for(var k=0; k<stps.length; k++) {
                var d = p.d[k] || '';
                rowHtml += '<td onclick="editCell('+j+','+k+')">'+d+'</td>';
            }
            rowHtml += '</tr>';
            b.innerHTML += rowHtml;
        }
    }

    function addProject() {
        var val = document.getElementById('p_in').value;
        if(val) {
            prjs.push({n: val, d: {}, f: false});
            document.getElementById('p_in').value = '';
            refresh();
        } else { alert("Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"); }
    }

    function addStep() {
        var val = document.getElementById('s_in').value;
        if(val) {
            stps.push(val);
            document.getElementById('s_in').value = '';
            refresh();
        } else { alert("Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"); }
    }

    // Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¯ÛŒØª Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡
    function editP(i) {
        var n = prompt("ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡:", prjs[i].n);
        if(n) { prjs[i].n = n; refresh(); }
    }

    // Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¯ÛŒØª Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡
    function editS(i) {
        var n = prompt("ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø§Ù… Ù…Ø±Ø­Ù„Ù‡:", stps[i]);
        if(n) { stps[i] = n; refresh(); }
    }

    function editCell(pi, si) {
        var old = prjs[pi].d[si] || '';
        var txt = prompt("Ú¯Ø²Ø§Ø±Ø´:", old.replace(/<br>/g, '\n'));
        if(txt !== null) {
            var now = new Date();
            var time = now.getHours() + ":" + now.getMinutes();
            prjs[pi].d[si] = time + " - " + txt.replace(/\n/g, '<br>') + "<br>" + old;
            refresh();
        }
    }

    function toggleP(i) { prjs[i].f = !prjs[i].f; refresh(); }
    function delS(i) { if(confirm('Ø­Ø°Ù Ù…Ø±Ø­Ù„Ù‡ØŸ')) { stps.splice(i,1); refresh(); } }

    function exportData() {
        var blob = new Blob([JSON.stringify({prjs, stps})], {type: 'application/json'});
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "data.json"; a.click();
    }

    refresh();
</script>
</body>
</html>
